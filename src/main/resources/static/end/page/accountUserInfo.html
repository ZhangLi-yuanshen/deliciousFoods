<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="content-type" content="no-cache, must-revalidate" />
	<meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT"/>
	<title>个人信息</title>

	<link href="../css/bootstrap.min.css" rel="stylesheet"/>
	<link href="../css/font-awesome.css" rel="stylesheet"/>
	<link href="../css/basic.css" rel="stylesheet"/>
	<link href="../css/custom.css" rel="stylesheet"/>
	<link href="../css/element/index.css" rel="stylesheet"/>

	<style>
		[v-cloak] {
			display: none;
		}
	</style>
</head>
<body>
<div id="wrapper">
	<nav class="navbar navbar-default navbar-cls-top " role="navigation" style="margin-bottom: 0">
		<div class="navbar-header">
			<a class="navbar-brand" href="index.html">后端管理系统</a>
		</div>

		<div class="header-right">
			<a href="javascript:void(0)" class="btn btn-info" id="logout" title="退出登录">
				<i class="fa fa-sign-out fa-2x"></i>
			</a>
		</div>

		<div class="header-right">
			<a href="javascript:void(0)" class="btn btn-info" title="跳转到个人信息">
				<i class="fa fa-user fa-2x"></i>
			</a>
		</div>

		<div class="header-right" style="padding-top: 25px">欢迎你，<span id="username"></span></div>

		<div class="header-left">
			<a href="/front/index.html" class="btn btn-info" title="跳转到首页">
				<i class="fa fa-dot-circle-o fa-2x"></i>
			</a>
		</div>
	</nav>

	<div id="page-wrapper">
		<div id="page-inner">
			<div class="row">
				<div class="col-md-12">
					<h1 class="page-subhead-line">这是个人信息页，可以对自己的信息进行修改。</h1>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12">
					<div class="panel panel-default">
						<div class="panel-heading">
							个人信息
						</div>
						<div class="panel-body">
							<form class="form-horizontal">
								<input type="hidden" id="id">
								<div class="form-group">
									<label class="col-sm-3 control-label">姓名</label>
									<div class="col-sm-7">
										<input type="text" class="form-control" id="name" placeholder="请输入姓名">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">昵称</label>
									<div class="col-sm-7">
										<input type="text" class="form-control" id="nickName" placeholder="请输入昵称">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">性别</label>
									<div class="col-sm-7">
										<label class="radio-inline">
											<input type="radio" name="sex" value="男">男
										</label>
										<label class="radio-inline">
											<input type="radio" name="sex" value="女">女
										</label>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">年龄</label>
									<div class="col-sm-7">
										<input type="text" class="form-control" id="age" placeholder="请输入年龄">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">生日</label>
									<div class="col-sm-7">
										<input type="date" class="form-control" id="birthday" placeholder="选择生日">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">手机号</label>
									<div class="col-sm-7">
										<input type="text" class="form-control" id="phone" placeholder="请输入手机号">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">地址</label>
									<div class="col-sm-7">
										<input type="text" class="form-control" id="address" placeholder="请输入地址">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">邮箱</label>
									<div class="col-sm-7">
										<input type="text" class="form-control" id="email" placeholder="请输入邮箱">
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">身份证</label>
									<div class="col-sm-7">
										<input type="text" class="form-control" id="cardId" placeholder="请输入身份证">
									</div>
								</div>
							</form>
							<div style="text-align: center">
								<button type="button" class="btn btn-primary" id="updateBtn">保存</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="../js/vue2.6.11/axios.js"></script>

<script>
	$(document).ready(function () {
		// 加载用户信息
		axios.get("/getAccountInfo")
				.then(function (res) {
					if (res.data.code === '0') {
						var entity = res.data.data;
						$('#name').val(entity.name);
						$('#nickName').val(entity.nickName);
						$('input[name="sex"][value="' + entity.sex + '"]').prop('checked', true);
						$('#age').val(entity.age);
						$('#phone').val(entity.phone);
						$('#address').val(entity.address);
						$('#email').val(entity.email);
						$('#cardId').val(entity.cardId);
						$('#birthday').val(entity.birthday); // 假设生日格式合适
						$('#id').val(entity.id); // 设置 hidden 的 id
					} else {
						alert(res.data.msg);
					}
				});

		// 获取用户权限
		axios.get("/authority")
				.then(function (res) {
					if (res.data.code === '0') {
						var authority = res.data.data;
						// 根据权限显示不同菜单项
						if (authority.indexOf(1) != -1) {
							$('#adminInfo').show();
						}
						if (authority.indexOf(2) != -1) {
							$('#adminInfo').show();
						}
						// 更多权限判断...
					} else {
						alert(res.data.msg);
					}
				});

		// 获取当前用户
		var user = JSON.parse(localStorage.getItem('user'));
		$('#username').text(user.name);

		// 退出登录
		$('#logout').click(function () {
			logout(); // 假设 logout() 是一个函数
		});

		// 保存个人信息
		$('#updateBtn').click(function () {
			var entity = {
				id: $('#id').val(),
				name: $('#name').val(),
				nickName: $('#nickName').val(),
				sex: $('input[name="sex"]:checked').val(),
				age: $('#age').val(),
				birthday: $('#birthday').val(),
				phone: $('#phone').val(),
				address: $('#address').val(),
				email: $('#email').val(),
				cardId: $('#cardId').val()
			};

			if (checkValid(entity)) {
				axios.put("/userInfo", entity)
						.then(function (res) {
							if (res.data.code === '0') {
								alert('更新成功');
							} else {
								alert(res.data.msg);
							}
						});
			}
		});
	});

	// 表单验证
	function checkValid(entity) {
		if (!entity.name || !entity.nickName || !entity.phone || !entity.email) {
			alert('请填写所有必填字段');
			return false;
		}
		return true;
	}
</script>
</body>
</html>
