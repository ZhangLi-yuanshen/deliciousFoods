<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="content-type" content="no-cache, must-revalidate" />
    <meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT" />
    <title>公告</title>
    <link href="/front/css/bootstrap.min.css" rel="stylesheet">
    <link href="/front/css/my.css" rel="stylesheet">
    <link href="/front/css/nav.css" rel="stylesheet">

    <style>
        #notice-box li {
            margin-bottom: 10px;
        }

        #view-notice-body img {
            width: 400px;
        }

        #view-notice-body iframe {
            width: 400px;
        }
    </style>
</head>

<body>
<div id="wrapper">
    <div class="container">
        <!-- 头部开始 -->
        <div class="nx-header">
            <div style="display: flex;width: 100%; height: 30px; line-height: 30px; background-color: #eee;">
                <div style="flex: 5; text-align: right">
                        <span id="user-greeting">
                            欢迎您，<span id="user-name"></span>
                            <a id="logout-link" style="margin-right: 50px; color: blue" href="javascript:void(0)">退出</a>
                        </span>
                    <a id="login-link" href="/end/page/login.html" target="_blank" style="margin-right: 10px; color: #666666">登录</a>
                    <a href="/end/page/register.html" target="_blank" style="margin-right: 30px; color: #666666">注册</a>
                </div>
            </div>

            <div>
                <ul style="display: flex; background-color: orange; height: 30px">
                    <li class="nav-item"><a href="index.html">首页</a></li>
                    <li class="nav-item"><a class="active" href="advertiserInfo.html">系统公告</a></li>
                    <li class="nav-item"><a href="foodsMenuInfo.html">菜谱</a></li>
                    <li class="nav-item"><a href="collectInfo.html">收藏</a></li>
                    <li class="nav-item"><a href="notesInfo.html">笔记</a></li>
                    <li class="nav-item"><a href="newsInfo.html">饮食资讯</a></li>
                    <li class="nav-item"><a href="messageInfo.html">趣味答题</a></li>
                    <li id="admin-link" class="nav-item"><a href="/end/page/index.html" target="_blank">进入后台系统</a></li>
                </ul>
            </div>

        </div>
        <!-- 头部结束 -->
    </div>

    <div class="container" style="margin-top: 10px">
        <div class="row">
            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <b id="current-advertiser-name"></b>
                        <span style="float: right; color: #888888" id="current-advertiser-time"></span>
                    </div>
                    <div class="panel-body" id="view-notice-body"></div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="panel panel-default" id="notice-box">
                    <div class="panel-heading"><b>公告列表</b></div>
                    <div class="panel-body">
                        <ul id="notice-item-box"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--js库文件-->
<script src="js/jquery-1.10.2.js"></script>
<script src="js/vue2.6.11/axios.js"></script>

<script>
    $(document).ready(function () {
        var user = {};
        var currentId = getQueryVariable('id');
        var isShow = false;
        var advertiserList = [];
        var currentAdvertiser = {};

        function loadAdvertiserInfo() {
            $.get('/advertiserInfo/page/all?pageSize=10', function (res) {
                if (res.code === '0') {
                    advertiserList = res.data.list;
                    advertiserList.forEach(function (item) {
                        if (parseInt(currentId) === item.id) {  // 当前选择的公告
                            item.isActive = true;
                            currentAdvertiser = item;
                        } else {
                            item.isActive = false;
                        }
                    });

                    // Update advertiser list in the UI
                    var noticeItemBox = $('#notice-item-box');
                    noticeItemBox.empty();
                    advertiserList.forEach(function (item) {
                        var listItem = $('<li></li>');
                        var link = $('<a></a>').attr('href', 'advertiserInfo.html?id=' + item.id).addClass(item.isActive ? 'active' : '').text(item.name);
                        listItem.append(link);
                        noticeItemBox.append(listItem);
                    });

                    // Update the current advertiser info
                    $('#current-advertiser-name').text(currentAdvertiser.name);
                    $('#current-advertiser-time').text(currentAdvertiser.time);
                    $('#view-notice-body').html(currentAdvertiser.content);
                }
            });
        }

        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] === variable) {
                    return pair[1];
                }
            }
            return '1';
        }

        function checkUserStatus() {
            $.get('/auth', function (res) {
                if (res.code === '0') {
                    user = res.data;
                    if (user.level !== 3) {
                        isShow = true;
                        $('#admin-link').show();
                    }
                    $('#user-name').text(user.name);
                    $('#user-greeting').show();
                    $('#login-link').hide();
                }
            });
        }

        function logout() {
            $.get("/logout", function (res) {
                if (res.code === '0') {
                    location.href = '/front/index.html';
                } else {
                    alert('Error: ' + res.msg);
                }
            });
        }

        $('#logout-link').click(logout);
        $('#admin-link').toggle(isShow);

        checkUserStatus();
        loadAdvertiserInfo();
    });
</script>
</body>

</html>
